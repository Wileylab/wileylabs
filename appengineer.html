<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Page Engineer v2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: #1a1a1a;
            color: white;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Editor Sidebar */
        #editor {
            width: 420px;
            background: #222;
            border-right: 1px solid #333;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }

        /* Sections */
        h2.section-title {
            font-size: 1.1rem;
            border-bottom: 1px solid #444;
            padding-bottom: 5px;
            margin-bottom: 15px;
            color: #4CAF50;
            margin-top: 20px;
        }

        /* Inputs */
        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-size: 0.8rem;
            color: #aaa;
            margin-bottom: 5px;
        }

        input,
        textarea,
        select {
            width: 100%;
            background: #111;
            border: 1px solid #444;
            color: white;
            padding: 8px;
            rounded: 4px;
            font-family: inherit;
        }

        input[type="color"] {
            height: 40px;
            padding: 2px;
            cursor: pointer;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input:focus,
        textarea:focus,
        select:focus {
            border-color: #4CAF50;
            outline: none;
        }

        /* Lists (Features/Reviews) */
        .list-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .list-item {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .list-item input {
            margin-bottom: 0;
        }

        .btn-icon {
            background: #333;
            color: #aaa;
            border: 1px solid #444;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .btn-icon:hover {
            background: #444;
            color: white;
        }

        .btn-icon.delete {
            color: #ff4d4d;
            border-color: #500;
        }

        .btn-icon.delete:hover {
            background: #500;
            color: white;
        }

        .btn-add {
            width: 100%;
            background: #333;
            color: #4CAF50;
            border: 1px dashed #4CAF50;
            padding: 8px;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 5px;
            font-size: 0.9rem;
        }

        .btn-add:hover {
            background: #2a3a2a;
        }

        /* Upload Box */
        .upload-box {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            border: 2px dashed #555;
            text-align: center;
            margin-bottom: 20px;
        }

        .upload-box:hover {
            border-color: #4CAF50;
        }

        .upload-label {
            cursor: pointer;
            color: #4CAF50;
            font-size: 0.9rem;
            font-weight: bold;
            margin: 0;
        }

        /* Preview Area */
        #preview-container {
            flex: 1;
            position: relative;
            background: #0e0f11;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #preview-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: #0a0a0a;
        }

        /* Floating Actions */
        .fab-container {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 50;
        }

        .action-btn {
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        #download-btn {
            background: #4CAF50;
            color: white;
        }

        #copy-btn {
            background: #6f42c1;
            color: white;
        }

        /* Color Grid */
        .color-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>

<body>

    <div id="editor">
        <h1 class="text-xl font-bold text-white mb-2"><span class="text-green-500">AppPage</span> Engineer <span
                class="text-xs text-gray-500">v2.0</span></h1>

        <div class="upload-box">
            <label for="fileUpload" class="upload-label">
                <i class="fas fa-upload mb-2"></i><br>
                Load Existing App Page
            </label>
            <input type="file" id="fileUpload" accept=".html" style="display: none;" onchange="handleFileUpload(this)">
        </div>

        <h2 class="section-title">1. Theme & Colors</h2>
        <div class="color-grid">
            <div class="input-group">
                <label>Theme Color (Primary)</label>
                <input type="color" id="themeColor" oninput="updateState('themeColor', this.value)">
            </div>
            <div class="input-group">
                <label>Secondary Accent</label>
                <input type="color" id="secondaryColor" oninput="updateState('secondaryColor', this.value)">
            </div>
            <div class="input-group">
                <label>Background Dark</label>
                <input type="color" id="bgColorDark" oninput="updateState('bgColorDark', this.value)">
            </div>
            <div class="input-group">
                <label>Background Light</label>
                <input type="color" id="bgColorLight" oninput="updateState('bgColorLight', this.value)">
            </div>
            <div class="input-group">
                <label>Text Color</label>
                <input type="color" id="textColor" oninput="updateState('textColor', this.value)">
            </div>
            <div class="input-group">
                <label>Container BG (Alpha)</label>
                <input type="text" id="containerBg" placeholder="rgba(30, 30, 30, 0.85)"
                    oninput="updateState('containerBg', this.value)">
            </div>
        </div>

        <h2 class="section-title">2. Header Info</h2>
        <div class="input-group">
            <label>App Name</label>
            <input type="text" id="appName" oninput="updateState('appName', this.value)">
        </div>
        <div class="input-group">
            <label>Tagline / Caption</label>
            <input type="text" id="appCaption" oninput="updateState('appCaption', this.value)">
        </div>
        <div class="input-group">
            <label>Logo URL</label>
            <input type="text" id="appLogo" oninput="updateState('appLogo', this.value)">
        </div>
        <div class="input-group">
            <label>Download Link</label>
            <input type="text" id="downloadLink" oninput="updateState('downloadLink', this.value)">
        </div>
        <div class="input-group">
            <label>Floating Words (Comma separated)</label>
            <input type="text" id="floatingWords" oninput="updateState('floatingWords', this.value)">
        </div>


        <h2 class="section-title">3. Main Content</h2>
        <div class="input-group">
            <label>Content Title</label>
            <input type="text" id="contentTitle" oninput="updateState('contentTitle', this.value)">
        </div>
        <div class="input-group">
            <label>Description (Markdown supported)</label>
            <textarea id="appDescription" oninput="updateState('appDescription', this.value)"></textarea>
        </div>

        <h2 class="section-title">4. Key Features</h2>
        <div id="features-list" class="list-container"></div>
        <button class="btn-add" onclick="addItem('features')">+ Add Feature</button>

        <h2 class="section-title">5. Rating</h2>
        <div class="flex gap-2">
            <div class="input-group flex-1">
                <label>Score (e.g. 4.7)</label>
                <input type="text" id="ratingScore" oninput="updateState('ratingScore', this.value)">
            </div>
            <div class="input-group flex-1">
                <label>Review Count Text</label>
                <input type="text" id="ratingCount" oninput="updateState('ratingCount', this.value)">
            </div>
        </div>

        <h2 class="section-title">6. Screenshots</h2>
        <div id="reviews-list" class="list-container"></div>
        <button class="btn-add" onclick="addItem('reviews')">+ Add Screenshot URL</button>

        <div class="h-10"></div> <!-- Spacer -->
    </div>

    <div id="preview-container">
        <div class="fab-container">
            <button id="copy-btn" class="action-btn" onclick="copyHTML()">
                <i class="fas fa-copy"></i> Copy HTML
            </button>
            <button id="download-btn" class="action-btn" onclick="downloadHTML()">
                <i class="fas fa-download"></i> Download
            </button>
        </div>
        <iframe id="preview-frame"></iframe>
    </div>

    <script>
        // --- DEFAULT STATE ---
        const defaultState = {
            // Colors
            themeColor: "#4CAF50",
            secondaryColor: "#FFC107",
            bgColorDark: "#0a0a0a",
            bgColorLight: "#1a1a1a",
            textColor: "#E0E0E0",
            containerBg: "rgba(30, 30, 30, 0.85)",

            // Content
            appName: "**Rap Lyrics**",
            appCaption: "Rap Writing Assistant developed specially for Professional rappers.",
            appLogo: "assets/rlogo.png",
            downloadLink: "#",
            floatingWords: "RHYME, FLOW, BEAT, LYRICS, RAP, MUSIC, ARTIST, CREATIVE, WRITE",
            contentTitle: "âœ¨ What Makes Us Essential",
            appDescription: "Take your rap game to the next level with Rap Lyrics, the app designed specifically for professional rappers and aspiring artists to save time and reduce stress while creating powerful lyrics.\n\n**AI-Powered Rap Assistant ðŸŽ§**\nMeet your human-like AI rap writing assistant, designed to enhance your creativity. The latest update brings dual suggestions:\n1. Rhyming Line â€“ A line that perfectly rhymes with what youâ€™ve written.\n2. Non-Rhyming Line â€“ A natural next line when you donâ€™t want a rhyme every time.\n\n**Rap Generator for Every Mood â¤ï¸ðŸŽ™ï¸**\nFeeling stuck or just starting out? Our top-tier rap generator has got you covered.",
            features: [
                "âš¡ **Blazing Fast:** Optimized for the latest Android devices.",
                "ðŸ”’ **Secure & Private:** Your data is always protected.",
                "ðŸŽ¨ **Beautiful Dark Mode:** Easy on the eyes, day or night."
            ],
            ratingScore: "4.7",
            ratingCount: "Based on 1250+ reviews",
            reviews: [
                "https://via.placeholder.com/300x500/1E1E1E/E0E0E0?text=Review+Screenshot+1",
                "https://via.placeholder.com/300x500/1E1E1E/E0E0E0?text=Review+Screenshot+2",
                "https://via.placeholder.com/300x500/1E1E1E/E0E0E0?text=Review+Screenshot+3"
            ]
        };

        let data = JSON.parse(JSON.stringify(defaultState));

        // --- RENDER EDITOR ---
        function renderEditor() {
            // Colors
            document.getElementById('themeColor').value = data.themeColor || defaultState.themeColor;
            document.getElementById('secondaryColor').value = data.secondaryColor || defaultState.secondaryColor;
            document.getElementById('bgColorDark').value = data.bgColorDark || defaultState.bgColorDark;
            document.getElementById('bgColorLight').value = data.bgColorLight || defaultState.bgColorLight;
            document.getElementById('textColor').value = data.textColor || defaultState.textColor;
            document.getElementById('containerBg').value = data.containerBg || defaultState.containerBg;

            // Content
            document.getElementById('appName').value = data.appName;
            document.getElementById('appCaption').value = data.appCaption;
            document.getElementById('appLogo').value = data.appLogo;
            document.getElementById('downloadLink').value = data.downloadLink;
            document.getElementById('floatingWords').value = data.floatingWords || defaultState.floatingWords;
            document.getElementById('contentTitle').value = data.contentTitle;
            document.getElementById('appDescription').value = data.appDescription;
            document.getElementById('ratingScore').value = data.ratingScore;
            document.getElementById('ratingCount').value = data.ratingCount;

            renderList('features', data.features);
            renderList('reviews', data.reviews);
        }

        function renderList(type, list) {
            const container = document.getElementById(type + '-list');
            container.innerHTML = list.map((item, index) => `
                <div class="list-item">
                    <input type="text" value="${item.replace(/"/g, '&quot;')}" oninput="updateListItem('${type}', ${index}, this.value)">
                    <button class="btn-icon delete" onclick="deleteListItem('${type}', ${index})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        // --- UPDATE LOGIC ---
        function updateState(key, value) {
            data[key] = value;
            debouncedUpdatePreview();
        }

        function updateListItem(type, index, value) {
            data[type][index] = value;
            debouncedUpdatePreview();
        }

        function deleteListItem(type, index) {
            data[type].splice(index, 1);
            renderList(type, data[type]);
            updatePreview();
        }

        function addItem(type) {
            if (type === 'features') data.features.push("New Feature");
            if (type === 'reviews') data.reviews.push("https://via.placeholder.com/300x500");
            renderList(type, data[type]);
            updatePreview();
        }

        let debounceTimer;
        function debouncedUpdatePreview() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(updatePreview, 300);
        }

        // --- PREVIEW GENERATOR (THE CORE) ---
        function getPageHTML() {
            // Helper to render markdown-ish bolding
            const processText = (text) => text ? text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>') : '';

            const wordsArray = (data.floatingWords || "").split(',').map(s => s.trim()).filter(s => s);
            const floatingWordsScript = `
            const words = ${JSON.stringify(wordsArray)};
            const container = document.querySelector('.container');
            const fragment = document.createDocumentFragment();
            for (let i = 0; i < 12; i++) {
                if(words.length === 0) break;
                const text = document.createElement('div');
                text.className = 'floating-text';
                text.textContent = words[Math.floor(Math.random() * words.length)];
                text.style.top = Math.random() * 100 + '%';
                text.style.left = Math.random() * 100 + '%';
                text.style.animationDelay = (Math.random() * 15) + 's';
                text.style.animationDuration = (15 + Math.random() * 20) + 's';
                fragment.appendChild(text);
            }
            document.body.appendChild(fragment);`;

            const featuresHTML = data.features.map(f => `<li>${processText(f)}</li>`).join('');

            const reviewsHTML = data.reviews.map(url => `
                <div class="screenshot-item">
                    <img src="${url}" alt="Review Screenshot">
                </div>
            `).join('');

            // Generate stars
            const score = parseFloat(data.ratingScore) || 0;
            let starsHTML = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= score) starsHTML += 'â˜…';
                else if (i - 0.5 <= score) starsHTML += '<span style="opacity:0.5;">â˜…</span>';
                else starsHTML += '<span style="color:#555;">â˜…</span>';
            }

            // Using Css Variables for dynamic customization
            const css = `
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Orbitron:wght@400;500&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --theme-color: ${data.themeColor};
            --secondary-color: ${data.secondaryColor};
            --bg-dark: ${data.bgColorDark};
            --bg-light: ${data.bgColorLight};
            --text-color: ${data.textColor};
            --container-bg: ${data.containerBg};
        }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            background: radial-gradient(ellipse at top, var(--bg-light) 0%, var(--bg-dark) 70%);
            min-height: 100vh;
        }
        /* Animated BG */
        .bg-elements { position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: -1; overflow: hidden; }
        .bg-element { position: absolute; border-radius: 50%; opacity: 0.1; filter: blur(40px); animation: float 25s infinite linear; }
        .bg-element:nth-child(1) { width: 300px; height: 300px; background: linear-gradient(45deg, var(--theme-color), #2E7D32); top: 10%; left: 5%; }
        .bg-element:nth-child(2) { width: 200px; height: 200px; background: linear-gradient(45deg, var(--secondary-color), #FF9800); top: 60%; right: 10%; animation-delay: -5s; animation-duration: 20s; }
        .bg-element:nth-child(3) { width: 250px; height: 250px; background: linear-gradient(45deg, #2196F3, #0D47A1); bottom: 10%; left: 15%; animation-delay: -10s; animation-duration: 30s; }
        @keyframes float { 0%, 100% { transform: translate(0, 0) rotate(0deg); } 25% { transform: translate(20px, 40px) rotate(90deg); } 50% { transform: translate(0, 80px) rotate(180deg); } 75% { transform: translate(-20px, 40px) rotate(270deg); } }
        
        /* Container */
        .container {
            max-width: 1100px; margin: 0 auto; background-color: var(--container-bg); padding: 30px; border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative; overflow: hidden; animation: fadeIn 1.2s ease-out; margin-top: 20px; margin-bottom: 20px;
        }
        .container::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 5px;
            background: linear-gradient(90deg, var(--theme-color), var(--secondary-color), var(--theme-color));
            background-size: 200% 100%; animation: gradientShift 3s infinite linear;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes gradientShift { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }

        /* Header */
        .header-row { display: flex; align-items: center; justify-content: space-between; padding-bottom: 30px; flex-wrap: wrap; }
        .app-info { display: flex; align-items: center; gap: 25px; }
        .logo { 
            width: 90px; height: 90px; border-radius: 22px; background-color: #333; background-size: cover; background-position: center; 
            box-shadow: 0 8px 25px rgba(0,0,0, 0.3); transition: all 0.4s ease; animation: pulse 4s infinite ease-in-out;
            border: 2px solid rgba(255,255,255,0.1);
        }
        .logo:hover { transform: scale(1.05) rotate(5deg); box-shadow: 0 12px 35px rgba(0,0,0, 0.5); }
        @keyframes pulse { 0%, 100% { box-shadow: 0 8px 25px rgba(0,0,0, 0.3); } 50% { box-shadow: 0 8px 30px rgba(0,0,0, 0.6); } }
        
        .text-info h1 { margin: 0; font-size: 2.5em; color: var(--theme-color); font-family: 'Orbitron', sans-serif; text-shadow: 0 0 10px rgba(0,0,0, 0.5); letter-spacing: 1px; }
        .text-info p { margin: 10px 0 0 0; font-size: 1.1em; color: #AAA; max-width: 500px; }

        .download-btn {
            background: linear-gradient(45deg, var(--theme-color), #2E7D32); color: #FFFFFF; padding: 16px 30px; text-decoration: none;
            border-radius: 12px; font-size: 1.2em; font-weight: bold; transition: all 0.3s ease; box-shadow: 0 6px 20px rgba(0,0,0, 0.4);
            display: flex; align-items: center; gap: 10px; animation: buttonFloat 3s infinite ease-in-out;
        }
        .download-btn:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0, 0.6); filter: brightness(1.1); }
        @keyframes buttonFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        .divider { border: 0; height: 2px; background: linear-gradient(to right, transparent, var(--theme-color), transparent); margin: 25px 0 40px 0; position: relative; }
        .divider::after { content: 'ðŸŽ¤'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1E1E1E; padding: 0 15px; font-size: 1.5em; border-radius: 50%; }

        /* Content */
        .content-row { display: flex; gap: 40px; margin-bottom: 50px; flex-wrap: wrap; }
        .description-box { flex: 2; min-width: 300px; }
        .description-box h2 { color: var(--secondary-color); font-size: 1.8em; margin-bottom: 20px; font-family: 'Orbitron', sans-serif; display: flex; align-items: center; gap: 10px; }
        .description-box h2::before { content: ''; width: 10px; height: 30px; background: linear-gradient(to bottom, var(--theme-color), var(--secondary-color)); border-radius: 5px; }
        .description-box p { margin-bottom: 20px; color: #CCC; line-height: 1.8; padding-left: 20px; border-left: 3px solid rgba(255,255,255, 0.1); }
        .description-box ul { list-style: none; padding-left: 0; margin-top: 25px; }
        .description-box li { margin-bottom: 15px; padding-left: 35px; position: relative; transition: transform 0.3s ease; }
        .description-box li:hover { transform: translateX(10px); color: #FFF; }
        .description-box li::before { content: 'ðŸŽµ'; position: absolute; left: 0; top: 0; font-size: 1.2em; }

        /* Rating */
        .rating-box {
            flex: 1; background: linear-gradient(135deg, rgba(40,40,40,0.9), rgba(30,30,30,0.9)); padding: 30px; border-radius: 18px;
            text-align: center; box-shadow: 0 10px 30px rgba(0,0,0, 0.5); border: 1px solid rgba(255,255,255, 0.1); min-width: 250px;
            transition: transform 0.4s ease;
        }
        .rating-box:hover { transform: translateY(-10px); }
        .rating-number { font-size: 4em; font-weight: bold; color: var(--secondary-color); margin-bottom: 10px; font-family: 'Orbitron', sans-serif; }
        .stars { color: var(--secondary-color); font-size: 2.2em; letter-spacing: 5px; margin-bottom: 15px; }
        .review-count { color: #A0A0A0; font-size: 1em; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; display: inline-block; }

        /* Screenshots */
        .screenshots-row h2 { color: var(--text-color); font-size: 1.8em; margin-bottom: 25px; padding-left: 15px; font-family: 'Orbitron', sans-serif; }
        .screenshot-gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; }
        .screenshot-item { background-color: #252525; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0, 0.4); transition: all 0.4s ease; cursor: pointer; }
        .screenshot-item:hover { transform: translateY(-15px) scale(1.03); box-shadow: 0 20px 40px rgba(0,0,0, 0.6); }
        .screenshot-item img { width: 100%; height: auto; display: block; border: 2px solid transparent; border-radius: 15px; transition: all 0.5s ease; }
        .screenshot-item:hover img { border-color: var(--theme-color); filter: brightness(1.1); }

        /* Floating Text */
        .floating-text { position: absolute; color: rgba(255,255,255, 0.05); font-size: 1.5em; pointer-events: none; animation: floatText 15s infinite linear; z-index: -1; font-weight: 900; }
        @keyframes floatText { 0% { transform: translate(0, 0) rotate(0deg); opacity: 0; } 10% { opacity: 0.3; } 90% { opacity: 0.3; } 100% { transform: translate(100px, -100px) rotate(360deg); opacity: 0; } }

        @media (max-width: 768px) {
            .header-row { flex-direction: column; align-items: flex-start; }
            .app-info { margin-bottom: 20px; }
            .download-btn { width: 100%; justify-content: center; }
            .container { padding: 20px; margin: 10px; }
            .text-info h1 { font-size: 2em; }
        }`;

            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${processText(data.appName).replace(/<[^>]*>?/gm, '')}</title>
    <script id="site-data" type="application/json">${JSON.stringify(data)}<\/script>
    <style>${css}</style>
</head>
<body>
    <div class="bg-elements">
        <div class="bg-element"></div><div class="bg-element"></div><div class="bg-element"></div>
    </div>
    
    <div class="container">
        <div class="header-row">
            <div class="app-info">
                <div class="logo" style="background-image: url('${data.appLogo}');" title="App Logo"></div>
                <div class="text-info">
                    <h1>${processText(data.appName)}</h1>
                    <p>${processText(data.appCaption)}</p>
                </div>
            </div>
            <a href="${data.downloadLink}" class="download-btn" target="_blank"><span>ðŸŽµ</span> DOWNLOAD NOW</a>
        </div>

        <hr class="divider">

        <div class="content-row">
            <div class="description-box">
                <h2>${processText(data.contentTitle)}</h2>
                <div>${processText(data.appDescription)}</div>
                <ul>${featuresHTML}</ul>
            </div>

            <div class="rating-box">
                <p class="rating-number">${data.ratingScore}</p>
                <div class="stars">${starsHTML}</div>
                <p class="review-count">${data.ratingCount}</p>
            </div>
        </div>
        
        <div class="screenshots-row">
            <h2>ðŸ’– What Our Users Are Saying</h2>
            <div class="screenshot-gallery">${reviewsHTML}</div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Interactive js
            ${floatingWordsScript}
            
            // Hover effects
            const features = document.querySelectorAll('.description-box li');
            features.forEach(feature => {
                feature.addEventListener('mouseenter', function () { this.style.transform = 'translateX(10px)'; });
                feature.addEventListener('mouseleave', function () { this.style.transform = 'translateX(0)'; });
            });
            
             // Parallax
            document.addEventListener('mousemove', function (e) {
                const bgElements = document.querySelectorAll('.bg-element');
                const x = e.clientX / window.innerWidth;
                const y = e.clientY / window.innerHeight;
                bgElements.forEach((el, index) => {
                    const speed = 0.5 + index * 0.2;
                    const moveX = (x - 0.5) * 20 * speed;
                    const moveY = (y - 0.5) * 20 * speed;
                    el.style.transform = \`translate(\${moveX}px, \${moveY}px)\`;
                });
            });
        });
    <\/script>
</body>
</html>`;
        }

        function updatePreview() {
            const frame = document.getElementById('preview-frame');
            const html = getPageHTML();
            frame.srcdoc = html;
        }

        // --- FILE HANDLING ---
        function handleFileUpload(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (e) {
                const content = e.target.result;
                const parser = new DOMParser();
                const doc = parser.parseFromString(content, 'text/html');
                const scriptTag = doc.getElementById('site-data');

                if (scriptTag) {
                    try {
                        const loadedData = JSON.parse(scriptTag.textContent);
                        // Merge loaded data with default structure to ensure new fields (like colors) exist
                        data = { ...defaultState, ...loadedData };
                        // Ensure arrays are arrays
                        if (!Array.isArray(data.features)) data.features = defaultState.features;
                        if (!Array.isArray(data.reviews)) data.reviews = defaultState.reviews;

                        renderEditor();
                        updatePreview();
                        alert("App Page Data Loaded!");
                    } catch (err) { alert("Error: Data corrupted."); console.error(err); }
                } else {
                    alert("No 'site-data' found. Please ensure this file was created with this tool.");
                }
            };
            reader.readAsText(file);
        }

        function downloadHTML() {
            const html = getPageHTML();
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'apppage.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function copyHTML() {
            const html = getPageHTML();
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(html).then(showSuccess).catch(() => fallbackCopy(html));
            } else { fallbackCopy(html); }
        }

        function fallbackCopy(text) {
            var textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try { document.execCommand('copy'); showSuccess(); } catch (err) { alert("Copy failed."); }
            document.body.removeChild(textArea);
        }

        function showSuccess() {
            const btn = document.getElementById('copy-btn');
            const originalText = '<i class="fas fa-copy"></i> Copy HTML';
            btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
            btn.style.background = '#28a745';
            setTimeout(() => { btn.innerHTML = originalText; btn.style.background = '#6f42c1'; }, 2000);
        }

        // --- INIT ---
        renderEditor();
        updatePreview();

    </script>
</body>

</html>